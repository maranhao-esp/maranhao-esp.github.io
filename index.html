<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nosso Espa√ßo ‚ù§Ô∏è</title>

<style>
body{
font-family:Arial;
background:#ffd6e7;
margin:0;
padding:20px;
}
.container{max-width:700px;margin:auto;}
.card{
background:white;
padding:15px;
border-radius:15px;
margin-bottom:15px;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
button{
background:#ff4f87;
border:none;
color:white;
padding:6px 10px;
border-radius:8px;
cursor:pointer;
}
input{padding:8px;border-radius:8px;border:1px solid #ccc;width:60%;}
.msg{background:#ffeaf2;padding:8px;border-radius:8px;margin:5px 0;}
small{color:#555;}
.reply{font-size:12px;background:#fff0f6;padding:4px;border-left:3px solid #ff4f87;margin-bottom:4px;}
</style>
</head>

<body>
<div class="container">

<h1>Nosso Espa√ßo ‚ù§Ô∏è</h1>
<p id="contador"></p>

<div class="card">
<button id="loginBtn">Entrar com Google</button>
<p id="userInfo">N√£o logado</p>
</div>

<div class="card">
<h3>üí¨ Chat <span id="digitando"></span></h3>
<div id="chatBox"></div>
<div id="replyPreview"></div>
<input id="chatInput">
<button onclick="enviarChat()">Enviar</button>
</div>

<div class="card">
<h3>üí≠ Pensamentos</h3>
<div id="pensamentosBox"></div>
<input id="pensamentoInput">
<button onclick="enviarPensamento()">Enviar</button>
</div>

<div class="card">
<h3>üìã Lista Livre</h3>
<div id="listaBox"></div>
<input id="listaInput">
<button onclick="enviarLista()">Adicionar</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,GoogleAuthProvider,signInWithPopup,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,collection,addDoc,deleteDoc,updateDoc,doc,onSnapshot,query,orderBy,setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"COLOCA_AQUI",
authDomain:"COLOCA_AQUI",
projectId:"COLOCA_AQUI",
storageBucket:"COLOCA_AQUI",
messagingSenderId:"COLOCA_AQUI",
appId:"COLOCA_AQUI"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth();
const db=getFirestore();

const contasPermitidas=[
"lorenzemanuelly@gmail.com",
"caua60198@gmail.com"
];

let usuario=null;
let replyMsg=null;

loginBtn.onclick=()=>signInWithPopup(auth,new GoogleAuthProvider());

onAuthStateChanged(auth,(user)=>{
if(user){
if(!contasPermitidas.includes(user.email)){
alert("Conta n√£o permitida");
auth.signOut();
return;
}
usuario=user;
userInfo.innerText="Logado: "+user.displayName;
}
});

function hora(){
return new Date().toLocaleTimeString();
}

chatInput.oninput=()=>{
if(usuario){
setDoc(doc(db,"digitando","status"),{
nome:usuario.displayName,
texto:chatInput.value.length>0?"digitando...":""
});
}
};

onSnapshot(doc(db,"digitando","status"),snap=>{
if(snap.exists()){
digitando.innerText=snap.data().nome+" "+snap.data().texto;
}
});

async function enviarChat(){
if(!usuario)return;
await addDoc(collection(db,"chat"),{
nome:usuario.displayName,
texto:chatInput.value,
hora:hora(),
reply:replyMsg
});
chatInput.value="";
replyMsg=null;
replyPreview.innerHTML="";
}

async function enviarPensamento(){
if(!usuario)return;
await addDoc(collection(db,"pensamentos"),{
nome:usuario.displayName,
texto:pensamentoInput.value,
hora:hora()
});
pensamentoInput.value="";
}

async function enviarLista(){
if(!usuario)return;
await addDoc(collection(db,"lista"),{
nome:usuario.displayName,
texto:listaInput.value,
hora:hora()
});
listaInput.value="";
}

function responder(texto){
replyMsg=texto;
replyPreview.innerHTML="<div class='reply'>Respondendo: "+texto+"</div>";
}

async function apagar(id){
await deleteDoc(doc(db,"chat",id));
}

async function editar(id,texto){
let novo=prompt("Editar mensagem:",texto);
if(novo){
await updateDoc(doc(db,"chat",id),{texto:novo});
}
}

onSnapshot(query(collection(db,"chat"),orderBy("hora")),snap=>{
chatBox.innerHTML="";
snap.forEach(d=>{
let m=d.data();
chatBox.innerHTML+=`
<div class="msg">
${m.reply?`<div class="reply">${m.reply}</div>`:""}
${m.nome}: ${m.texto}
<br><small>${m.hora}</small>
<br>
<button onclick="responder('${m.texto}')">Responder</button>
<button onclick="editar('${d.id}','${m.texto}')">Editar</button>
<button onclick="apagar('${d.id}')">Apagar</button>
</div>`;
});
});

onSnapshot(collection(db,"pensamentos"),snap=>{
pensamentosBox.innerHTML="";
snap.forEach(d=>{
let m=d.data();
pensamentosBox.innerHTML+=`<div class="msg">${m.nome}: ${m.texto}</div>`;
});
});

onSnapshot(collection(db,"lista"),snap=>{
listaBox.innerHTML="";
snap.forEach(d=>{
let m=d.data();
listaBox.innerHTML+=`<div class="msg">‚Ä¢ ${m.texto} - ${m.nome}</div>`;
});
});

window.enviarChat=enviarChat;
window.enviarPensamento=enviarPensamento;
window.enviarLista=enviarLista;
window.apagar=apagar;
window.editar=editar;
window.responder=responder;

const inicio=new Date("2024-01-01");
setInterval(()=>{
let dias=Math.floor((new Date()-inicio)/86400000);
contador.innerText="‚ù§Ô∏è "+dias+" dias juntos";
},1000);

</script>
</body>
</html>
