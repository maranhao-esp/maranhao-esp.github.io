<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nosso Espa√ßo üíñ</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #ff758f; --bg: #fff5f6; --accent: #c9184a; --text: #592d33; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--text); }
        .header { background: white; padding: 15px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 10; }
        .container { padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(255,117,143,0.1); margin-bottom: 15px; position: relative; }
        
        /* Contador */
        .contador-dias { text-align: center; font-weight: bold; color: var(--accent); margin-bottom: 10px; font-size: 0.9rem; background: #fff0f3; padding: 10px; border-radius: 12px; }

        /* Chat */
        .chat-box { height: 350px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; padding: 5px; }
        .msg { padding: 10px 14px; border-radius: 18px; max-width: 75%; font-size: 0.95rem; line-height: 1.4; position: relative; }
        .msg.me { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .msg.other { align-self: flex-start; background: #fce4ec; color: #333; border-bottom-left-radius: 2px; }
        .msg-info { font-size: 0.65rem; font-weight: bold; margin-bottom: 2px; display: block; opacity: 0.7; }

        /* Listas */
        .lista-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ffebee; }
        .badge { position: absolute; top: 12px; right: 20%; width: 10px; height: 10px; background: red; border-radius: 50%; display: none; }

        input { width: 100%; padding: 12px; border: 2px solid #ffccd5; border-radius: 12px; margin-bottom: 8px; box-sizing: border-box; outline: none; }
        button { width: 100%; background: linear-gradient(135deg, #ff758f, #ff4d6d); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: bold; }
        
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; padding-bottom: env(safe-area-inset-bottom); }
        .tab-btn { flex: 1; padding: 18px; background: none; border: none; color: #ffb3c1; font-weight: bold; font-size: 0.75rem; position: relative; }
        .tab-btn.active { color: var(--accent); border-top: 3px solid var(--accent); }
    </style>
</head>
<body>

    <audio id="som-ping" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>

    <div class="header"><h2>Nosso Espa√ßo ‚ù§Ô∏è</h2></div>

    <div id="view-chat" class="container">
        <div class="contador-dias" id="contador-container">
            üóìÔ∏è Juntos h√° <span id="num-dias">...</span> dias
        </div>

        <div class="card">
            <small>üí≠ Pensamento do Dia</small>
            <div id="pensamento-texto" style="font-style: italic; margin: 8px 0; color: var(--accent); font-size: 1.1rem;">Carregando...</div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="input-pensamento" placeholder="Novo pensamento..." style="margin:0; font-size: 0.8rem;">
                <button onclick="mudarPensamento()" style="width:80px; padding:5px; font-size: 0.7rem;">Mudar</button>
            </div>
        </div>

        <div class="card">
            <div class="chat-box" id="chat-conteudo"></div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="input-msg" placeholder="Escreva aqui..." style="margin:0;">
                <button onclick="enviarMsg()" style="width: 60px;">‚úàÔ∏è</button>
            </div>
        </div>
    </div>

    <div id="view-listas" class="container" style="display:none;">
        <div class="card">
            <h3>üìÇ Novas Listas</h3>
            <input type="text" id="nome-nova-lista" placeholder="Nome da pasta (ex: Filmes)">
            <button onclick="criarLista()">Criar Pasta</button>
        </div>
        <div id="area-listas"></div>
    </div>

    <nav class="tab-bar">
        <button class="tab-btn active" id="btn-c" onclick="mudarAba('c')">MENSAGENS</button>
        <button class="tab-btn" id="btn-l" onclick="mudarAba('l')">
            LISTAS <span id="badge-l" class="badge"></span>
        </button>
    </nav>

    <script>
        // --- CONFIGURA√á√ÉO ---
        const firebaseConfig = {
  apiKey: "AIzaSyAsK3kEuustv7KyoQXR0Ep-whTpDCDa03w",
  authDomain: "manuu-c23a7.firebaseapp.com",
  databaseURL: "https://manuu-c23a7-default-rtdb.firebaseio.com",
  projectId: "manuu-c23a7",
  storageBucket: "manuu-c23a7.firebasestorage.app",
  messagingSenderId: "378235951611",
  appId: "1:378235951611:web:72c855fbb5ccdb1a84535e",
  measurementId: "G-2V1EXW1794"
};

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // CHAVE DUPLA E DATA DE IN√çCIO
        const CHAVE_DUPLA = "26012025"; 
        const DATA_INICIO = new Date("2025-01-26");

        let meuNome = localStorage.getItem('meuNome') || prompt("Quem √© voc√™?");
        localStorage.setItem('meuNome', meuNome || "Algu√©m");

        // L√≥gica do Contador
        function atualizarContador() {
            const hoje = new Date();
            const diferenca = hoje - DATA_INICIO;
            const dias = Math.floor(diferenca / (1000 * 60 * 60 * 24));
            document.getElementById('num-dias').innerText = dias;
        }
        atualizarContador();

        let primeiraCargaChat = true;
        let primeiraCargaListas = true;

        // Pensamento
        db.ref(CHAVE_DUPLA + '/pensar').on('value', s => document.getElementById('pensamento-texto').innerText = s.val() || "Defina um pensamento...");
        function mudarPensamento() {
            const t = document.getElementById('input-pensamento').value;
            if(t) { db.ref(CHAVE_DUPLA + '/pensar').set(t); document.getElementById('input-pensamento').value = ''; }
        }

        // Chat com Som
        db.ref(CHAVE_DUPLA + '/chat').limitToLast(20).on('value', s => {
            const box = document.getElementById('chat-conteudo');
            box.innerHTML = '';
            s.forEach(child => {
                const m = child.val();
                const classe = m.user === meuNome ? 'me' : 'other';
                box.innerHTML += `<div class="msg ${classe}"><span class="msg-info">${m.user}</span>${m.text}</div>`;
            });
            box.scrollTop = box.scrollHeight;
            if(!primeiraCargaChat) document.getElementById('som-ping').play().catch(()=>{});
            primeiraCargaChat = false;
        });

        function enviarMsg() {
            const t = document.getElementById('input-msg').value;
            if(t) { db.ref(CHAVE_DUPLA + '/chat').push({user: meuNome, text: t}); document.getElementById('input-msg').value = ''; }
        }

        // Listas com Bolinha Vermelha
        db.ref(CHAVE_DUPLA + '/pastas').on('value', s => {
            const area = document.getElementById('area-listas');
            area.innerHTML = '';
            if(!primeiraCargaListas && document.getElementById('view-listas').style.display === 'none') {
                document.getElementById('badge-l').style.display = 'block';
            }
            s.forEach(pasta => {
                const nome = pasta.key;
                let itensHtml = '';
                pasta.child('itens').forEach(it => {
                    itensHtml += `<div class="lista-item"><span>${it.val().txt}</span><small style="color:red" onclick="removerItem('${nome}','${it.key}')">‚úï</small></div>`;
                });
                area.innerHTML += `
                    <div class="card">
                        <h4 style="margin:0 0 10px 0">${nome}</h4>
                        <div>${itensHtml}</div>
                        <div style="display:flex; gap:5px; margin-top:10px;">
                            <input type="text" id="in-${nome}" placeholder="Novo item..." style="margin:0; padding:8px;">
                            <button onclick="addItem('${nome}')" style="width:40px">+</button>
                        </div>
                        <button onclick="removerPasta('${nome}')" style="background:none; color:red; font-size:0.6rem; margin-top:10px; width: auto; padding: 0;">Apagar Pasta</button>
                    </div>`;
            });
            primeiraCargaListas = false;
        });

        function criarLista() {
            const n = document.getElementById('nome-nova-lista').value;
            if(n) { db.ref(CHAVE_DUPLA + '/pastas/' + n).set({criado: true}); document.getElementById('nome-nova-lista').value = ''; }
        }
        function addItem(p) {
            const v = document.getElementById('in-' + p).value;
            if(v) { db.ref(CHAVE_DUPLA + '/pastas/' + p + '/itens').push({txt: v}); document.getElementById('in-' + p).value = ''; }
        }
        function removerItem(p, i) { db.ref(CHAVE_DUPLA + '/pastas/' + p + '/itens/' + i).remove(); }
        function removerPasta(p) { if(confirm("Apagar lista inteira?")) db.ref(CHAVE_DUPLA + '/pastas/' + p).remove(); }

        function mudarAba(aba) {
            document.getElementById('view-chat').style.display = aba === 'c' ? 'block' : 'none';
            document.getElementById('view-listas').style.display = aba === 'l' ? 'block' : 'none';
            document.getElementById('btn-c').classList.toggle('active', aba === 'c');
            document.getElementById('btn-l').classList.toggle('active', aba === 'l');
            if(aba === 'l') document.getElementById('badge-l').style.display = 'none';
        }
    </script>
</body>
</html>
