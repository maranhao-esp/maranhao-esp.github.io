<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nosso Espa√ßo ‚ù§Ô∏è</title>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

<style>
body{font-family:sans-serif;background:#fff5f6;margin:0;padding:15px}
.card{background:white;padding:15px;border-radius:15px;margin-bottom:10px}
.msg{padding:10px;border-radius:15px;margin:5px 0;max-width:75%}
.me{background:#ff758f;color:white;margin-left:auto}
.other{background:#fce4ec}
.reply{font-size:0.7rem;opacity:0.7;border-left:3px solid #ff758f;padding-left:5px;margin-bottom:3px}
</style>
</head>

<body>

<h2>Nosso Espa√ßo ‚ù§Ô∏è</h2>
<button onclick="login()">Entrar com Google</button>
<div id="user"></div>

<div class="card">
<h4>üí≠ Pensamentos</h4>
<div id="pensamentos"></div>
<input id="input-pensamento">
<button onclick="enviarPensamento()">Enviar</button>
</div>

<div class="card">
<div id="chat"></div>
<div id="digitando"></div>
<input id="msg" oninput="digitando()">
<button onclick="enviar()">Enviar</button>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyAsK3kEuustv7KyoQXR0Ep-whTpDCDa03w",
authDomain:"manuu-c23a7.firebaseapp.com",
databaseURL:"https://manuu-c23a7-default-rtdb.firebaseio.com",
projectId:"manuu-c23a7"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const auth=firebase.auth();

const emailsPermitidos=[
"lorenzemanuelly@gmail.com",
"caua60198@gmail.com"
];

let user=null;
let respondendo=null;

function login(){
const provider=new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(provider);
}

auth.onAuthStateChanged(u=>{
if(!u)return;
if(!emailsPermitidos.includes(u.email)){
alert("Sem permiss√£o");
auth.signOut();
return;
}
user=u;
document.getElementById("user").innerText="Logado: "+u.displayName;
carregar();
});

function carregar(){

db.ref("chat").on("value",s=>{
const chat=document.getElementById("chat");
chat.innerHTML="";
s.forEach(c=>{
const m=c.val();
let div=document.createElement("div");
div.className="msg "+(m.uid===user.uid?"me":"other");

let hora=new Date(m.time).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

div.innerHTML=
(m.reply?`<div class='reply'>${m.reply}</div>`:"")+
m.nome+": "+m.text+
"<br><small>"+hora+"</small>";

div.onclick=()=>{respondendo=m.text};
chat.appendChild(div);
});
});

db.ref("pensamentos").on("value",s=>{
const area=document.getElementById("pensamentos");
area.innerHTML="";
s.forEach(c=>{
const p=c.val();
area.innerHTML+=`<div>${p.nome}: ${p.text}</div>`;
});
});

db.ref("digitando").on("value",s=>{
document.getElementById("digitando").innerText=
s.val() && s.val()!=user.displayName
? s.val()+" est√° digitando..."
:"";
});

}

function enviar(){
const t=document.getElementById("msg").value;
if(!t)return;
db.ref("chat").push({
uid:user.uid,
nome:user.displayName,
text:t,
reply:respondendo,
time:Date.now()
});
respondendo=null;
document.getElementById("msg").value="";
db.ref("digitando").set("");
}

function enviarPensamento(){
const t=document.getElementById("input-pensamento").value;
if(!t)return;
db.ref("pensamentos").push({
nome:user.displayName,
text:t
});
document.getElementById("input-pensamento").value="";
}

function digitando(){
db.ref("digitando").set(user.displayName);
}
</script>

</body>
</html>
